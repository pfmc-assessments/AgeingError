<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="AgeingError">
<title>Estimating ageing error using the TMB model written by André Punt • AgeingError</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating ageing error using the TMB model written by André Punt">
<meta property="og:description" content="AgeingError">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">AgeingError</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting_started.html">Estimating ageing error using the TMB model written by André Punt</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pfmc-assessments/AgeingError/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimating ageing error using the TMB model written by André Punt</h1>
                        <h4 data-toc-skip class="author">Paul Burch
based on documentation written by André Punt</h4>
            
            <h4 data-toc-skip class="date">8 September 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pfmc-assessments/AgeingError/blob/HEAD/vignettes/getting_started.Rmd" class="external-link"><code>vignettes/getting_started.Rmd</code></a></small>
      <div class="d-none name"><code>getting_started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Uncertainty in age estimates needs to be accounted for when
undertaking stock assessments. Punt et al. (2008) provides methods for
estimating ageing error matrices that account for both ageing bias and
imprecision. We provide some documentation and examples of the Template
Model Builder (TMB) implementation these methods, incorporating
documentation written by André Punt.</p>
<p>This vignette is illustrated using data and settings associated with
three stocks in the Australian Southern and Eastern Scalefish and Shark
Fishery (SESSF) fishery (Blue Grenadier, Bight Redfish, and School
Whiting), as well as sablefish from the U.S. west coast.</p>
</div>
<div class="section level2">
<h2 id="software">Software<a class="anchor" aria-label="anchor" href="#software"></a>
</h2>
<p>The current implementation of the software was written by André Punt
in 2020 and subsequently updated in 2022. There are several slightly
different versions of the source code in circulation, we use the version
maintained by Kelli Johnson (NOAA NWFSC). We have consulted with André
Punt and agreed that future development of the ageing error code should
be done through the NWFSC GitHub repository.</p>
<div class="section level3">
<h3 id="ageing-error-r-package">Ageing Error R package<a class="anchor" aria-label="anchor" href="#ageing-error-r-package"></a>
</h3>
<p>The NOAA Northwest Fisheries Science Center (NWFSC) GitHub site hosts
the <code>AgeingError</code> package. The newer TMB version of the
software replaced the ADMB version in the main branch of the repository
in May 2024. The ADMB version is still available via the git
history.</p>
<p>You can install the TMB branch directly from GitHub using the code
below. Note both TMB and Rtools need to be installed to do this.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pfmc-assessments/AgeingError"</span><span class="op">)</span></span></code></pre></div>
<p>The package can then be loaded.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pfmc-assessments.github.io/AgeingError/index.html" class="external-link">AgeingError</a></span><span class="op">)</span></span></code></pre></div>
<p>The software requires the data and model are specified using input
files which are described below.</p>
</div>
</div>
<div class="section level2">
<h2 id="input-files">Input files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h2>
<p>There are two input files needed to run the software the data file
(.dat extension) and the specifications file (.spc extension). These are
described below using Blue Grenadier (BG2022) as the example.</p>
<div class="section level3">
<h3 id="data-file">Data file<a class="anchor" aria-label="anchor" href="#data-file"></a>
</h3>
<p>The data file (.dat extension) contains the age comparison data by
pair of readers and specifies the range of ages permitted in the data,
the minus and plus groups and the reference age. The data file comprises
two or more sections (the age range then one section for each data pair
of reader comparisons)</p>
<p>The age range is simply specified by providing the minimum and
maximum ages. The data can’t fall outside the specified age range or the
code will generate an error.</p>
<p>The input files are parsed by the software using keywords that need
to match exactly what is expected, so the text “Range_of_ages” is part
of the input and not just a comment to help the user keep track of the
format.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>Range_of_ages</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>0 25</span></code></pre></div>
<p>The data can be entered with a separate data set for each pair of
readers, or a single data set for all pairs of readers. Both these
options are described below.</p>
<div class="section level4">
<h4 id="separate-data-sets">Separate Data Sets<a class="anchor" aria-label="anchor" href="#separate-data-sets"></a>
</h4>
<p>For each pair of readers (often the first and second reads by the
same reader) there is one section with the header
<code>Data_set_x</code> (x=1, 2, etc). The four lines immediately below
the header are</p>
<ul>
<li>The number of rows of paired age determinations (described
below)</li>
<li>The number of readers in this data set (always 2 for the SESSF)</li>
<li>The minus group, plus group, and reference age</li>
<li>The reader numbers</li>
</ul>
<p>The remainder of the data set comprises one row of data for each pair
of age determinations with the following format. The columns for each
reader (1-6) represent an age, while the left most column represents the
number of times that pair of ages were assigned by the two readers. The
columns for the other readers (if any) need to be filled with
<code>-999</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>Data_set_1</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>141     # number of lines</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>2       # Number of readers</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>1 20 5  # minus group; plus group; reference age</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        1     2     3     4    # Which readers   </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>9       0     0   -999   -999</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>1       0    10   -999   -999</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>153     1     1   -999   -999</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>25      1     2   -999   -999</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>...</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>2      23    23   -999   -999</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>1      24    23   -999   -999</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>2      24    24   -999   -999</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>1      25    24   -999   -999</span></code></pre></div>
<p>A second (and potentially a third) data set follow the same format as
the first data set, with the data being associated with the next pair of
readers (see below). The headers for each data set need to have headers
numbered from 1 to <code>NDataSet</code> which is an input to
<code><a href="../reference/CreateData.html">CreateData()</a></code>. That is, if <code>NDataSet=3</code>, the data
file needs to have sections with header <code>Data_set_1</code>,
<code>Data_set_2</code>, and <code>Data_set_3</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>Data_set_2</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>123     # number of lines</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>2       # Number of readers</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>1 20 5  # minus group; plus group; reference age</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        3     4     1     2 # which readers</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>27      1     1   -999   -999</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>13      1     2   -999   -999</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>3       2     1   -999   -999</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>227     2     2   -999   -999</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>...</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>2      22    20   -999   -999</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>1      22    21   -999   -999</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>1      23    21   -999   -999</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>1      23    22   -999   -999</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combined-data-set">Combined Data Set<a class="anchor" aria-label="anchor" href="#combined-data-set"></a>
</h4>
<p>The alternative to having separate data sets for each pair of readers
is to combine multiple pairs of readers in a single data set as shown
below. For this format the number of readers is now 4 and the data for
the second pair of readers follows on from the end of the first
pair.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>Data_set_1</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>264     # number of lines</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>4       # Number of readers</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>0 25 5  # minus group; plus group; reference age</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>        1     2     3     4 # Which readers   </span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>9       0     0   -999   -999</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>1       0    10   -999   -999</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>153     1     1   -999   -999</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>30      1     2   -999   -999</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>...</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>1      24    23   -999   -999</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>2      24    24   -999   -999</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>1      25    24   -999   -999</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>27   -999  -999     1     1</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>13   -999  -999     1     2</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>3    -999  -999     2     1</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>...</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>2    -999  -999    22    20</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>1    -999  -999    22    21</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>1    -999  -999    23    21</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>1    -999  -999    23    22</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="other-considerations">Other Considerations<a class="anchor" aria-label="anchor" href="#other-considerations"></a>
</h4>
<p>Note that the ages need to be whole numbers in the data file. The C++
code adds 0.5 to each age so the model it fitting to the midpoint of an
age bin.</p>
<p>Different agencies have created R code specific to the format of
their ageing comparison data to format it for this package. For instance
CSIRO uses the R package <code>SESSFdataproc</code> and hosts examples
are in the assessment repository <code>SESSFassessments</code>. A
version of this code is available from CSIRO. They usually create the
data file in Excel (using the summarised output from the R code) and
then paste into a text file.</p>
<p>The data file is read into R using the function
<code><a href="../reference/CreateData.html">CreateData()</a></code> which is described in the examples below.</p>
</div>
</div>
<div class="section level3">
<h3 id="specifications-file">Specifications file<a class="anchor" aria-label="anchor" href="#specifications-file"></a>
</h3>
<p>The age-estimates for at least one of the age-readers must be assumed
to be unbiased (sensitivity to the choice of this age-reader should be
examined if there is uncertainty about which age-reader is most likely
to be unbiased). The options for bias and precision are described below
and entered into the specifications file (.spc extension), an example of
which is provided after the description of the model options.</p>
<div class="section level4">
<h4 id="bias-options">Bias options<a class="anchor" aria-label="anchor" href="#bias-options"></a>
</h4>
<p>The available options for bias are:</p>
<ul>
<li><p><code>-x</code> Assume that the relationship between expected age
and true age is the same as that for reader x. [Note that the ‘’x’’ must
be lower than the number of the reader for which bias is being defined.
Reader 2 can have <code>BiasOpt=-1</code> to match reader 1].</p></li>
<li><p><code>0</code> Age-estimates are unbiased.</p></li>
<li><p><code>1</code> The expected age of an animal of age <span class="math inline">\(a\)</span>, <span class="math inline">\(E_a\)</span>, is a linear function of its true
age, i.e. <span class="math inline">\(E_a =\alpha a\)</span> (constant
coefficient of variation).</p></li>
<li><p><code>2</code> The expected age of an animal of age <span class="math inline">\(a\)</span>, <span class="math inline">\(E_a\)</span>, is a given by:</p></li>
</ul>
<p><span class="math display">\[E_a = E_L + (E_H -
E_L)\frac{1-\text{exp}(-\beta(a-1))}{1-\text{exp}(-\beta(a_{max}-1))}\]</span>.</p>
<p>The C++ code (<code>AgeingError.cpp</code>) also has conditional (if)
statements for Bias options 4 and 5 but these are identical to option 0
(unbiased) and therefore presumably placeholders for some future
options.</p>
<p>In the SESSF we typically assume that all readers are unbiased
(<code>BiasOpt=0</code>), however, it is important to check this
assumption using the residual plots (André Punt pers. comm.)</p>
</div>
<div class="section level4">
<h4 id="sigma-options">Sigma options<a class="anchor" aria-label="anchor" href="#sigma-options"></a>
</h4>
<p>The available options for random ageing precision are:</p>
<ul>
<li><p><code>-x</code>. Assume that the relationship between the
variance of age-reading error and true age is the same as that for
reader x [note that ‘’x’’ must be lower than the number of the reader
for which bias is being defined].</p></li>
<li><p><code>1</code> This option assumes a constant coefficient of
variation, it has one parameter that needs to be specified for each pair
of independent readers in the specification (.spc) file. The standard
deviation of random age-reading error, <span class="math inline">\(\sigma_a\)</span>, is a linear function of true
age, i.e.:</p></li>
</ul>
<p><span class="math display">\[
  \sigma_a =
  \begin{cases}
    \gamma &amp; \text{if  } a=0 \\
    \gamma a &amp; \text{otherwise} \\
  \end{cases}
\]</span></p>
<ul>
<li>
<code>2</code> The parameters relate to the standard deviation
(Michaelis-Menten equation). This option has three parameters that need
to be specified for each pair of independent readers in the
specification (.spc) file. The standard deviation of random age-reading
error, <span class="math inline">\(\sigma_a\)</span>, is given by:</li>
</ul>
<p><span class="math display">\[
  \sigma_a =
  \begin{cases}
    \sigma_L + (\sigma_H -
\sigma_L)\frac{1}{1-exp(-\delta(a_{max}-1))}   &amp; \text{if  } a=0 \\
    \sigma_L + (\sigma_H -
\sigma_L)\frac{1-exp(-\delta(a-1))}{1-exp(-\delta(a_{max}-1))} &amp;
\text{otherwise} \\
  \end{cases}
\]</span></p>
<ul>
<li>
<code>3</code> The parameters relate to the coefficient of variation
(Michaelis-Menten equation). This option has three parameters that need
to be specified for each pair of independent readers in the
specification (.spc) file. The coefficient of variation of random
age-reading error, <span class="math inline">\(CV_a\)</span>, is given
by:</li>
</ul>
<p><span class="math display">\[
  CV_a =
  \begin{cases}
    CV_L + (CV_H -
CV_L)\frac{1}{1-\text{exp}(-\delta(a_{max}-1))}   &amp; \text{if  } a=0
\\
    CV_L + (CV_H -
CV_L)\frac{1-\text{exp}(-\delta(a-1))}{1-\text{exp}(-\delta(a_{max}-1))}
&amp; \text{otherwise} \\
  \end{cases}
\]</span></p>
<ul>
<li><p><code>4</code> The estimates of age are exact (use this option
for ‘’known age’’ individuals). This option returns a vector of zeroes
(or perhaps just a single zero).</p></li>
<li><p><code>5</code> The standard deviation of random age-reading
error, <span class="math inline">\(\sigma_a\)</span>, is a spline
function of age (a Forsythe, Malcolm, and Moler type spline as
implemented by <code>tmbutils::splinefun()</code>). The number and
location (ages) of the knots must be specified, with the number of
parameters equal to the number of knots. Bounds and initial parameters
need to be specified in log space.</p></li>
<li><p><code>6</code> The standard deviation of random age-reading
error, <span class="math inline">\(\sigma_a\)</span>, is a piecewise
linear function of age. The number and location (ages) of the knots must
be specified, with the number of parameters equal to the number of
knots. Bounds and initial parameters need to be specified in log
space.</p></li>
<li><p><code>7</code> A linear change in the standard deviation of
random age-reading error, <span class="math inline">\(\sigma_a\)</span>,
with age. This option has two parameters that need to be specified for
each pair of independent readers in the specifications (.spc)
file.</p></li>
<li><p><code>8</code> A linear change in the coefficient of variation of
random age-reading error, <span class="math inline">\(CV_a\)</span> ,
with age. This option has two parameters that need to be specified for
each pair of independent readers in the specifications (.spc)
file.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="example-specifications-file">Example Specifications file<a class="anchor" aria-label="anchor" href="#example-specifications-file"></a>
</h4>
<p>The .spc file contains three or four sections: 1. reader
specification, 2. knots for splines or breakpoints for piecewise linear
functions (if used), 3. bias parameters, and 4. the sigma
parameters.</p>
<p>The first section specifies the Bias and Sigma options for each
reader. For each reader, one line specifies their Bias and Sigma
options. <code>SigmaOpt=-x</code> is used to assume the relationship
between expected age and true age is the same as that for reader x [note
that the <code>x</code> must be lower than the number of the reader for
which bias is being defined].</p>
<p>The example below (from Blue Grenadier) shows two pairs of readers
(1-2 &amp; 3-4) who are all specified to be unbiased
(<code>BiasOpt=0</code>) with readers 1 and 2 having the same ageing
precision <code>SigmaOpt=2</code>. This model requires three parameters
to be specified (presumably <span class="math inline">\(\sigma_L\)</span>, <span class="math inline">\(\sigma_H\)</span>, and <span class="math inline">\(\delta\)</span>) for each pair of readers (in the
case of Blue Grenadier the first and second reads from two readers).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a># reader BiasOpt SigmaOpt </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>       1       0        2            </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>       2       0       -1            </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>       3       0        2             </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>       4       0       -3 </span></code></pre></div>
<p>The second (optional) section species the knots for the spline and
linear interpolation models. The example below is taken from School
Whiting (<code>WHS2.spc</code>). It specifies five knots with the first
and last knots being the minimum and maximum ages. Note that the text “#
Spline specifications” or “# Linear specifications” are required by the
code if SigmaOpt options 5 or 6 are used.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a># Spline specifications</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>5</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>0 3 5 7 9</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a># Linear specifications</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>5</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>0 3 5 7 9</span></code></pre></div>
<p>The next section specifies conditions under which the Bias parameters
are estimated. We need to provide the bounds, initial values and whether
the parameter should be estimated (1) or pre-specified (0) at the
initial value. If <code>Bias=0</code> (the case for SESSF stocks) this
section is blank (NULL), although we retain the heading (not sure if the
heading is needed). The Sablefish example (Sable.spc) provides an
example of how to implement bias within ageing error estimation.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>Bias_Pars (low high init, on/off)  </span></code></pre></div>
<p>The final section specifies conditions under which the Sigma
parameters are estimated. Like above, we need to provide the bounds,
initial values and whether the parameter should be estimated (1). One
set of parameter bounds, initial values and on/off needs to be provide
for each group of readers that assume the same ageing uncertainty (group
of <code>x/-x</code>). In the example below (<code>SigmaOpt=2</code>)
there are three parameters for each pair of readers.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>Sigma_Pars (low high init, on/off)  </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    0    1   0.2   1    # Readers 1 &amp; 2</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a> 0.01    1   0.2   1</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    0    2   0.5   1</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    </span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>    0    1   0.2   1    # Readers 3 &amp; 4  </span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a> 0.01    1   0.2   1</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    0    2   0.5   1</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>For the examples we focus on SESSF species, which all specify
(<code>BiasOpt=0</code>). If bias in the age readings is suspected, an
example of how to implement bias within ageing error estimation is
provided in the Sablefish example (Sable.spc).</p>
<div class="section level3">
<h3 id="blue-grenadier">Blue Grenadier<a class="anchor" aria-label="anchor" href="#blue-grenadier"></a>
</h3>
<p>Blue Grenadier (<em>Macruronus novaezelandiae</em>) is deep water
species caught by trawl in south eastern Australia (Tuck and
Bessell-Browne 2022). It has age readings from two separate readers who
have each re-read their own reads (i.e. there are no inter-reader
comparisons in the production data). In 2022, estimating ageing error
for Blue Grenadier was challenging, requiring removal of problematic
data, different models for each reader and improvements to the model
source code. We work through this example below.</p>
<p>The function to load the data file into R isn’t currently exported
from the ageing error R package so we need to use <code>:::</code> to
access it. Note we are using the data file with a single data set so we
set <code>NDataSet=1</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"AgeingError"</span><span class="op">)</span></span>
<span><span class="va">BG2022_dat</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateData.html">CreateData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"BG2022.dat"</span><span class="op">)</span>, NDataSet<span class="op">=</span><span class="fl">1</span>, </span>
<span>                                       verbose<span class="op">=</span><span class="cn">TRUE</span>, EchoFile<span class="op">=</span><span class="st">"BG2022echo.out"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## readers 1 2 3 4 </span></span>
<span><span class="co">## Last line of data set 1 is 1 -999 -999 23 22 </span></span>
<span><span class="co">## WARNING - there are some missing data; the effective sample size calculation may be dubious, </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of rows in NrowStruc 2 </span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] "ReaderStruc"</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span><span class="co">## [1,]    1 6099    1    2    0    0</span></span>
<span><span class="co">## [2,]    1 4512    0    0    3    4</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    0    0    2</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    1    2    2</span></span>
<span><span class="co">## List of 16</span></span>
<span><span class="co">##  $ MinAge     : num 0</span></span>
<span><span class="co">##  $ MaxAge     : num 25</span></span>
<span><span class="co">##  $ NDataSet   : num 1</span></span>
<span><span class="co">##  $ MaxReader  : num 4</span></span>
<span><span class="co">##  $ TheData    : num [1, 1:264, 1:5] 9 1 153 30 1 12 454 51 33 499 ...</span></span>
<span><span class="co">##  $ Npnt       : num 264</span></span>
<span><span class="co">##  $ ReadPnt    : num [1, 1:4] 1 2 3 4</span></span>
<span><span class="co">##  $ NReaders   : num 4</span></span>
<span><span class="co">##  $ MinusA     : num 0</span></span>
<span><span class="co">##  $ PlusA      : num 25</span></span>
<span><span class="co">##  $ RefAge     : num 5</span></span>
<span><span class="co">##  $ ReaderSumm : num [1, 1:3] 1 2 2</span></span>
<span><span class="co">##  $ ReaderStruc: num [1:2, 1:6] 1 1 6099 4512 1 ...</span></span>
<span><span class="co">##  $ MaxCells   : num 676</span></span>
<span><span class="co">##  $ TotalN     : num 10611</span></span>
<span><span class="co">##  $ EffN       : num 10611</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>When we set <code>verbose=TRUE</code> a summary of the loaded data is
printed to the console. Check that the this matches with the input file,
some things that are worth checking include,</p>
<ul>
<li><p>The last line of each data set.</p></li>
<li><p>The total number reads for each reader pair.</p></li>
<li><p>The number of readers and their order.</p></li>
<li><p>The plus, minus and reference ages.</p></li>
</ul>
<p>There’s a warning about potentially missing data, this occurs when
there are ages below the minimum age and above the maximum age, however,
the warning does not appear to be correct in this case. Possibly the
<code>-999</code> values in the data are causing the warning because
they are &lt;0.</p>
<p>Next we load the model specifications using the
<code>CreateSpecs</code> function. This function is not exported either
so again we need to call the package name and <code>:::</code> to access
it.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022_spc</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateSpecs.html">CreateSpecs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"BG2022.spc"</span><span class="op">)</span>, DataSpecs<span class="op">=</span><span class="va">BG2022_dat</span>, </span>
<span>                                       verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ ModelSpecs:List of 4</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 2</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num [1:3] 0.2 0.001 0.5</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num [1:3] 0 0.01 0</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num [1:3] 1 1 2</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num [1:3] 1 1 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 2</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num [1:3] 0.2 0.001 0.5</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num [1:3] 0 0.01 0</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num [1:3] 1 1 2</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num [1:3] 1 1 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -3</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##  $ NumSigma  : num 6</span></span>
<span><span class="co">##  $ NumBias   : num 0</span></span>
<span><span class="co">##  $ xvalsL    : num [1:4, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknotsL   : num [1:4] 0 0 0 0</span></span>
<span><span class="co">##  $ xvals     : num [1:4, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknots    : num [1:4] 0 0 0 0</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>The function creates a nested list with one list element for each
reader in the data. By setting <code>verbose=TRUE</code>, the list will
print to the console and you can check that the inputs have been read in
correctly. Note a reader that has a <code>-x</code> for the Sigma option
(i.e. the relationship between expected age and true age is the same as
that for reader x) will not have parameter values. The output from this
function varies with the model that is specified (i.e. the knots will
all be zero unless a spline or piecewise linear model is specified -
sigma options 5 and 6).</p>
<p>Ageing error is the estimated using the function
<code>DoApplyAgeError</code>. This function is exported from the R
package so can be called directly. We need to provide a name
(<code>Species</code> argument), the data, model specs, specify the
weights (<code>AprobWght</code> and <code>SlopeWght</code>) and the name
of a subdirectory to save the output (it gets created if it doesn’t
exist). We set <code>verbose=FALSE</code> in this example as a large
amount of output is printed to the screen.</p>
<!-- The output of this function isn't useful, set results="hide" -->
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022_mod</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">::</span><span class="fu"><a href="../reference/DoApplyAgeError.html">DoApplyAgeError</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"BG2022"</span>,</span>
<span>                                           DataSpecs <span class="op">=</span> <span class="va">BG2022_dat</span>,</span>
<span>                                           ModelSpecsInp <span class="op">=</span> <span class="va">BG2022_spc</span>,</span>
<span>                                           AprobWght <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>                                           SlopeWght <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                                           SaveDir <span class="op">=</span> <span class="st">"Results"</span>,</span>
<span>                                           verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The model is stored as a list in the object <code>BG2022_mod</code>
and this information along with the data and model specifications is
saved in the output directory as an lda file with name
<code>Species</code> (in this case “BG2022.lda”).</p>
<p>Examine the structure of the model object</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">BG2022_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 12</span></span>
<span><span class="co">##  $ par     : Named num [1:31] 0.1672 0.2357 0.5399 0.2418 0.0247 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:31] "SDPar" "SDPar" "SDPar" "SDPar" ...</span></span>
<span><span class="co">##  $ fn      :function (x)  </span></span>
<span><span class="co">##  $ gr      :function (x = last.par[lfixed()], ...)  </span></span>
<span><span class="co">##  $ he      :function (x = last.par[lfixed()], atomic = usingAtomics())  </span></span>
<span><span class="co">##  $ hessian : logi FALSE</span></span>
<span><span class="co">##  $ method  : chr "BFGS"</span></span>
<span><span class="co">##  $ retape  :function (set.defaults = TRUE)  </span></span>
<span><span class="co">##  $ env     :&lt;environment: 0x5579e3008048&gt; </span></span>
<span><span class="co">##  $ report  :function (par = last.par)  </span></span>
<span><span class="co">##  $ simulate:function (par = last.par, complete = FALSE)  </span></span>
<span><span class="co">##  $ fn_orig :function (x = last.par[lfixed()], ...)  </span></span>
<span><span class="co">##  $ fitv    : num 40778</span></span></code></pre>
<p>We then save the model output using the <code>ProcessResults</code>
function, again using <code>:::</code> as this function also isn’t
exported. We want to specify that the effective sample size is estimated
(<code>CalcEff = TRUE</code>) as this produces the fits to the
individual data points which can be used to identify outliers that may
be impacting model convergence. The model creates several output files
that contain the ageing error estimates and the information we need to
assess the fit so we set <code>verbose = FALSE</code>.</p>
<p>This following files in the output subdirectory (in this case
<code>Results</code>).</p>
<ul>
<li><p>The report file (.rpt extension) which contains the convergence
criteria, model specifications, parameter estimates with their
uncertainty and ageing error matrices for each reader (note readers with
bias or sigma option <code>-x</code> will be identical to reader
<code>x</code>).</p></li>
<li><p>An LDA file (.lda extension) containing the data and model
specifications.</p></li>
<li><p>One csv file (.csv extension) for each reader that contains the
estimated standard deviation and coefficient of variation for each age
(note readers with bias or sigma option <code>-x</code> will be
identical to reader <code>x</code>).</p></li>
<li><p>A series png file (.png extension) that contain plots of the data
and model residuals.</p></li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022_out</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/ProcessResults.html">ProcessResults</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"BG2022"</span>, SaveDir <span class="op">=</span> <span class="st">"Results"</span>, CalcEff <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>An examination of the report file (<code>BG2022.rpt</code>) shows the
maximum gradient is -93.96, indicating the model has not converged.
Ideally the gradient should be between <span class="math inline">\(\pm
\text{1e-4}\)</span> and zero, however, in practice achieving this for
some models can be very time consuming and involves removing
progressively more data so we sometimes accept a gradient ~<span class="math inline">\(\pm \text{1e-3}\)</span>.</p>
<p>The residual plots show a large number of outliers exceeding the 95%
confidence interval and the table of fits to the individual data points
(bottom of the report file (only present when
<code>CalcEff = TRUE</code>) shows a number of data points with
predicted values of 0 (or very close to zero e.g. 10e-10), see line 2
below (extracted from the report file).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>Data set:  1</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>Data_set Group Group Line Readers Obs  Obs_Numbers Pred_Numbers</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>Data Point:  1   1   1   1   0   0   -1   -1   9     15.6581407   9.241041710732  </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>Data Point:  1   1   1   2   0   10  -1   -1   1    1.7397934   0  </span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>Data Point:  1   1   1   3   1   1   -1   -1   153   266.1883915 186.217154197499 </span></code></pre></div>
<p>To get closer to a converged model it was necessary to undertake data
trimming<br>
(removing observations values with predicted values of 0), specify a
different ageing error model for the second reader and prespecify
(i.e. fix) one of the parameters for the second reader. This was done in
a stepwise manner, with small changes being made, the model run and the
results examined before more changes were made until we achieved a final
model we considered acceptable.</p>
<p>We refit the final model (<code>BG2022_trim_8_1</code>).</p>
<p>Load the data file.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022final_dat</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateData.html">CreateData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"BG2022_trim_8_1.dat"</span><span class="op">)</span>,</span>
<span>                                            NDataSet<span class="op">=</span><span class="fl">1</span>, verbose<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                            EchoFile<span class="op">=</span><span class="st">"BG2022finalecho.out"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## readers 1 2 3 4 </span></span>
<span><span class="co">## Last line of data set 1 is 1 -999 -999 23 22 </span></span>
<span><span class="co">## WARNING - there are some missing data; the effective sample size calculation may be dubious, </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of rows in NrowStruc 2 </span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## [1] "ReaderStruc"</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span><span class="co">## [1,]    1 6079    1    2    0    0</span></span>
<span><span class="co">## [2,]    1 4512    0    0    3    4</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    0    0    2</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    1    2    2</span></span>
<span><span class="co">## List of 16</span></span>
<span><span class="co">##  $ MinAge     : num 0</span></span>
<span><span class="co">##  $ MaxAge     : num 25</span></span>
<span><span class="co">##  $ NDataSet   : num 1</span></span>
<span><span class="co">##  $ MaxReader  : num 4</span></span>
<span><span class="co">##  $ TheData    : num [1, 1:252, 1:5] 153 30 1 12 454 51 33 499 65 3 ...</span></span>
<span><span class="co">##  $ Npnt       : num 252</span></span>
<span><span class="co">##  $ ReadPnt    : num [1, 1:4] 1 2 3 4</span></span>
<span><span class="co">##  $ NReaders   : num 4</span></span>
<span><span class="co">##  $ MinusA     : num 0</span></span>
<span><span class="co">##  $ PlusA      : num 25</span></span>
<span><span class="co">##  $ RefAge     : num 5</span></span>
<span><span class="co">##  $ ReaderSumm : num [1, 1:3] 1 2 2</span></span>
<span><span class="co">##  $ ReaderStruc: num [1:2, 1:6] 1 1 6079 4512 1 ...</span></span>
<span><span class="co">##  $ MaxCells   : num 676</span></span>
<span><span class="co">##  $ TotalN     : num 10591</span></span>
<span><span class="co">##  $ EffN       : num 10591</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Note the number of lines of data has been reduced from 264 to
252.</p>
<p>Next we load the model specifications. For the second reader (3 and 4
in the data) we have specified a linear change in the standard deviation
of random age-reading error (<code>SigmaOpt=7</code>) and fixed the
first parameter at 0.2.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022final_spc</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateSpecs.html">CreateSpecs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"BG2022_trim_8_1.spc"</span><span class="op">)</span>,</span>
<span>                                             DataSpecs<span class="op">=</span><span class="va">BG2022final_dat</span>, </span>
<span>                                             verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ ModelSpecs:List of 4</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 2</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num [1:3] 0.2 0.001 0.5</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num [1:3] 0 0.01 0</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num [1:3] 1 1 2</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num [1:3] 1 1 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 7</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num [1:2] 0.2 0.5</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num [1:2] 0 0</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num [1:2] 1 2</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num [1:2] 0 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -3</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##  $ NumSigma  : num 5</span></span>
<span><span class="co">##  $ NumBias   : num 0</span></span>
<span><span class="co">##  $ xvalsL    : num [1:4, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknotsL   : num [1:4] 0 0 0 0</span></span>
<span><span class="co">##  $ xvals     : num [1:4, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknots    : num [1:4] 0 0 0 0</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>We run the final model.</p>
<!-- The output of this function isn't useful, set results="hide" -->
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022final_mod</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">::</span><span class="fu"><a href="../reference/DoApplyAgeError.html">DoApplyAgeError</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"BG2022_trim_8_1"</span>,</span>
<span>                                           DataSpecs <span class="op">=</span> <span class="va">BG2022final_dat</span>,</span>
<span>                                           ModelSpecsInp <span class="op">=</span> <span class="va">BG2022final_spc</span>,</span>
<span>                                           AprobWght <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>                                           SlopeWght <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                                           SaveDir <span class="op">=</span> <span class="st">"Results"</span>,</span>
<span>                                           verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>As with the earlier model we save the results.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BG2022final_out</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/ProcessResults.html">ProcessResults</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"BG2022_trim_8_1"</span>, SaveDir <span class="op">=</span> <span class="st">"Results"</span>, CalcEff <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>This model is now close to convergence (gradient = -0.00143) and
residual plots do not show any concerning features and the estimates of
ageing error standard deviation are increasing with age.</p>
</div>
<div class="section level3">
<h3 id="bight-redfish">Bight Redfish<a class="anchor" aria-label="anchor" href="#bight-redfish"></a>
</h3>
<p>Bight Redfish (<em>Centroberyx gerrardi</em>) is a long-lived species
caught by trawl in the Great Australian Bight (Curin-Osorio and Burch
2022). It has age readings from three separate readers who have each
re-read their own reads (i.e. there are no inter-reader comparisons in
the data).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REB2022_dat</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateData.html">CreateData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"REB2022.dat"</span><span class="op">)</span>, NDataSet<span class="op">=</span><span class="fl">1</span>, </span>
<span>                                       verbose<span class="op">=</span><span class="cn">TRUE</span>, EchoFile<span class="op">=</span><span class="st">"REB2022echo.out"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## readers 1 2 3 4 5 6 </span></span>
<span><span class="co">## Last line of data set 1 is 1 -999 -999 -999 -999 62 62 </span></span>
<span><span class="co">## WARNING - there are some missing data; the effective sample size calculation may be dubious, </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of rows in NrowStruc 3 </span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] "ReaderStruc"</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">## [1,]    1  800    1    2    0    0    0    0</span></span>
<span><span class="co">## [2,]    1  528    0    0    3    4    0    0</span></span>
<span><span class="co">## [3,]    1  682    0    0    0    0    5    6</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    0    0    3</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    1    2    3</span></span>
<span><span class="co">## List of 16</span></span>
<span><span class="co">##  $ MinAge     : num 0</span></span>
<span><span class="co">##  $ MaxAge     : num 64</span></span>
<span><span class="co">##  $ NDataSet   : num 1</span></span>
<span><span class="co">##  $ MaxReader  : num 6</span></span>
<span><span class="co">##  $ TheData    : num [1, 1:511, 1:7] 1 1 3 2 1 1 4 4 1 1 ...</span></span>
<span><span class="co">##  $ Npnt       : num 511</span></span>
<span><span class="co">##  $ ReadPnt    : num [1, 1:6] 1 2 3 4 5 6</span></span>
<span><span class="co">##  $ NReaders   : num 6</span></span>
<span><span class="co">##  $ MinusA     : num 5</span></span>
<span><span class="co">##  $ PlusA      : num 40</span></span>
<span><span class="co">##  $ RefAge     : num 15</span></span>
<span><span class="co">##  $ ReaderSumm : num [1, 1:3] 1 2 3</span></span>
<span><span class="co">##  $ ReaderStruc: num [1:3, 1:8] 1 1 1 800 528 682 1 0 0 2 ...</span></span>
<span><span class="co">##  $ MaxCells   : num 4225</span></span>
<span><span class="co">##  $ TotalN     : num 2010</span></span>
<span><span class="co">##  $ EffN       : num 2010</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>We check the summary above against the information in the data file.
There don’t appear to be any problems, however, we are still getting the
warning about missing data.</p>
<p>Next we load the model specifications using the
<code>CreateSpecs</code> function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REB2022_spc</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateSpecs.html">CreateSpecs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"REB2022.spc"</span><span class="op">)</span>,</span>
<span>                                         DataSpecs<span class="op">=</span><span class="va">REB2022_dat</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ ModelSpecs:List of 6</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num 0.1</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num 0.001</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num 10</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##  $ NumSigma  : num 1</span></span>
<span><span class="co">##  $ NumBias   : num 0</span></span>
<span><span class="co">##  $ xvalsL    : num [1:6, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknotsL   : num [1:6] 0 0 0 0 0 0</span></span>
<span><span class="co">##  $ xvals     : num [1:6, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknots    : num [1:6] 0 0 0 0 0 0</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>For Bight Redfish we fit a one parameter model assuming the expected
age is a linear function of the true age. We assume there is no
inter-reader variability (all readers have the same ageing uncertainty
as reader 1). Note that because we have specified all readers have the
same ageing uncertainty (readers 2–6 have <code>SigmaOpt=-1</code>), we
only need to provide one line of sigma parameters.</p>
<p>We estimate ageing error for Bight Redfish.</p>
<!-- The output of this function isn't useful, set results="hide" -->
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REB2022_mod</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">::</span><span class="fu"><a href="../reference/DoApplyAgeError.html">DoApplyAgeError</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"REB2022"</span>,</span>
<span>                                            DataSpecs <span class="op">=</span> <span class="va">REB2022_dat</span>,</span>
<span>                                            ModelSpecsInp <span class="op">=</span> <span class="va">REB2022_spc</span>,</span>
<span>                                            AprobWght <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>                                            SlopeWght <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                                            SaveDir <span class="op">=</span> <span class="st">"Results"</span>,</span>
<span>                                            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We then save the Bight Redfish model output.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REB2022_out</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/ProcessResults.html">ProcessResults</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"REB2022"</span>, SaveDir <span class="op">=</span> <span class="st">"Results"</span>, CalcEff <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>An examination of the report file (<code>REB2022.rpt</code>) shows
the maximum gradient is 0.0221, indicating the model has not quite
converged.</p>
<p>We remove four outliers with probability &lt;1e-5 and also start the
model at the estimated value of the CV (0.0413288). We save the revised
data and model specifications as (<code>REB2022_trim.dat</code> and
<code>REB2022_trim.spc</code>) and rerun the model (note we suppress the
creation of output in this document).</p>
<!-- set results="hide" -->
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">REB2022_dat2</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateData.html">CreateData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"REB2022_trim.dat"</span><span class="op">)</span>, NDataSet<span class="op">=</span><span class="fl">1</span>, </span>
<span>                  verbose<span class="op">=</span><span class="cn">FALSE</span>, EchoFile<span class="op">=</span><span class="st">"REB2022_trimecho.out"</span><span class="op">)</span></span>
<span><span class="va">REB2022_spc2</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateSpecs.html">CreateSpecs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"REB2022_trim.spc"</span><span class="op">)</span>,</span>
<span>                  DataSpecs<span class="op">=</span><span class="va">REB2022_dat2</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">REB2022_mod2</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">::</span><span class="fu"><a href="../reference/DoApplyAgeError.html">DoApplyAgeError</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"REB2022_final"</span>,</span>
<span>                  DataSpecs <span class="op">=</span> <span class="va">REB2022_dat2</span>, ModelSpecsInp <span class="op">=</span> <span class="va">REB2022_spc2</span>,</span>
<span>                  AprobWght <span class="op">=</span> <span class="fl">1e-06</span>, SlopeWght <span class="op">=</span> <span class="fl">0.01</span>, SaveDir <span class="op">=</span> <span class="st">"Results"</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">REB2022_out2</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/ProcessResults.html">ProcessResults</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"REB2022_final"</span>, </span>
<span>                  SaveDir <span class="op">=</span> <span class="st">"Results"</span>, CalcEff <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The final gradient is -0.001973, close to convergence.</p>
</div>
<div class="section level3">
<h3 id="school-whiting">School Whiting<a class="anchor" aria-label="anchor" href="#school-whiting"></a>
</h3>
<p>School Whiting (<em>Sillago flindersi</em>) is a short-lived species
caught by Danish seine and trawl in south eastern Australia (Day et
al. 2020). This species provides an example of a data file with three
separate data sets and a spline model.</p>
<p>Load the School Whiting data file, make sure to set the number of
data sets to three (<code>NDataSet=3</code>).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WHS2_dat</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateData.html">CreateData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"WHS2.dat"</span><span class="op">)</span>, NDataSet<span class="op">=</span><span class="fl">3</span>, </span>
<span>                  verbose<span class="op">=</span><span class="cn">TRUE</span>, EchoFile<span class="op">=</span><span class="st">"WHS2echo.out"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## readers 1 2 </span></span>
<span><span class="co">## readers 3 4 </span></span>
<span><span class="co">## readers 5 6 </span></span>
<span><span class="co">## Last line of data set 1 is 1 9 9 </span></span>
<span><span class="co">## Last line of data set 2 is 2 8 8 </span></span>
<span><span class="co">## Last line of data set 3 is 1 8 7 </span></span>
<span><span class="co">## Number of rows in NrowStruc 3 </span></span>
<span><span class="co">## [1] 3</span></span>
<span><span class="co">## [1] "ReaderStruc"</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">## [1,]    1 1882    1    2    0    0    0    0</span></span>
<span><span class="co">## [2,]    2  366    3    4    0    0    0    0</span></span>
<span><span class="co">## [3,]    3  385    5    6    0    0    0    0</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    0    0    1</span></span>
<span><span class="co">## [2,]    0    0    1</span></span>
<span><span class="co">## [3,]    0    0    1</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    1    2    1</span></span>
<span><span class="co">## [2,]    2    2    1</span></span>
<span><span class="co">## [3,]    3    2    1</span></span>
<span><span class="co">## List of 16</span></span>
<span><span class="co">##  $ MinAge     : num 0</span></span>
<span><span class="co">##  $ MaxAge     : num 9</span></span>
<span><span class="co">##  $ NDataSet   : num 3</span></span>
<span><span class="co">##  $ MaxReader  : num 6</span></span>
<span><span class="co">##  $ TheData    : num [1:3, 1:27, 1:7] 1 4 11 112 1 2 22 25 1 1 ...</span></span>
<span><span class="co">##  $ Npnt       : num [1:3] 27 23 22</span></span>
<span><span class="co">##  $ ReadPnt    : num [1:3, 1:6] 1 3 5 2 4 6 0 0 0 0 ...</span></span>
<span><span class="co">##  $ NReaders   : num [1:3] 2 2 2</span></span>
<span><span class="co">##  $ MinusA     : num [1:3] 0 0 0</span></span>
<span><span class="co">##  $ PlusA      : num [1:3] 9 9 9</span></span>
<span><span class="co">##  $ RefAge     : num [1:3] 5 5 5</span></span>
<span><span class="co">##  $ ReaderSumm : num [1:3, 1:3] 1 2 3 2 2 2 1 1 1</span></span>
<span><span class="co">##  $ ReaderStruc: num [1:3, 1:8] 1 2 3 1882 366 ...</span></span>
<span><span class="co">##  $ MaxCells   : num 100</span></span>
<span><span class="co">##  $ TotalN     : num [1:3] 1882 366 385</span></span>
<span><span class="co">##  $ EffN       : num [1:3] 1882 366 385</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Make sure to check the summary above against the values in the data
file.</p>
<p>Load the specifications for School Whiting.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WHS2_spc</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateSpecs.html">CreateSpecs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"WHS2.spc"</span><span class="op">)</span>,</span>
<span>                  DataSpecs<span class="op">=</span><span class="va">WHS2_dat</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Spline used to define SD for reader  1 </span></span>
<span><span class="co">## Selected knots are located at 0  3  5  7  9  </span></span>
<span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ ModelSpecs:List of 6</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 5</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num [1:5] -2.303 -1.204 -0.693 -0.105 0.9</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num [1:5] -10 -10 -10 -10 -10</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num [1:5] 40 40 40 40 40</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num [1:5] 1 1 1 1 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##  $ NumSigma  : num 5</span></span>
<span><span class="co">##  $ NumBias   : num 0</span></span>
<span><span class="co">##  $ xvalsL    : num [1:6, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknotsL   : num [1:6] 0 0 0 0 0 0</span></span>
<span><span class="co">##  $ xvals     : num [1:6, 1:100] 0 0 0 0 0 0 3 0 0 0 ...</span></span>
<span><span class="co">##  $ nknots    : num [1:6] 5 0 0 0 0 0</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>For School Whiting we fit a spline function
(<code>SigmaOption=5</code>) with five knots (0, 3, 5, 7, and 9). Note
the initial parameter values are in log space.</p>
<p>Fit the ageing error model and save the results</p>
<!-- Set results="hide" -->
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WHS2_mod</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">::</span><span class="fu"><a href="../reference/DoApplyAgeError.html">DoApplyAgeError</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"WHS2"</span>,</span>
<span>                  DataSpecs <span class="op">=</span> <span class="va">WHS2_dat</span>, ModelSpecsInp <span class="op">=</span> <span class="va">WHS2_spc</span>,</span>
<span>                  AprobWght <span class="op">=</span> <span class="fl">1e-06</span>, SlopeWght <span class="op">=</span> <span class="fl">0.01</span>, SaveDir <span class="op">=</span> <span class="st">"Results"</span>,</span>
<span>                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">WHS2_out</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/ProcessResults.html">ProcessResults</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"WHS2"</span>, </span>
<span>                  SaveDir <span class="op">=</span> <span class="st">"Results"</span>, CalcEff <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The maximum gradient is ~2.3-05 indicating the model has converged.
The estimated standard deviation by age shows the ageing uncertainty
increasing from age 0 to age 4, then declining for ages 5 and 6 before
increasing substantially for ages 7–9. The fits at the far right hand
side of the age distribution are poor and there is little data to inform
the model in this region. The appropriateness of this model should be
discussed with the ageing technicians.</p>
</div>
<div class="section level3">
<h3 id="sablefish">Sablefish<a class="anchor" aria-label="anchor" href="#sablefish"></a>
</h3>
<p>Sablefish (<em>Anoplopoma fimbria</em>) provides an example of using
the bias option.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sable_dat</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateData.html">CreateData</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"Sable.dat"</span><span class="op">)</span>, NDataSet<span class="op">=</span><span class="fl">1</span>, </span>
<span>                                      verbose<span class="op">=</span><span class="cn">TRUE</span>, EchoFile<span class="op">=</span><span class="st">"SableEcho.out"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## readers 1 2 3 4 5 6 </span></span>
<span><span class="co">## Last line of data set 1 is 6 -999 -999 -999 -999 2 2 </span></span>
<span><span class="co">## WARNING - there are some missing data; the effective sample size calculation may be dubious, </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of rows in NrowStruc 6 </span></span>
<span><span class="co">## [1] 6</span></span>
<span><span class="co">## [1] "ReaderStruc"</span></span>
<span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">## [1,]    1 8659    1    2    0    0    0    0</span></span>
<span><span class="co">## [2,]    1  282    0    2    3    0    0    0</span></span>
<span><span class="co">## [3,]    1 8138    0    0    3    4    0    0</span></span>
<span><span class="co">## [4,]    1  226    0    0    0    4    5    0</span></span>
<span><span class="co">## [5,]    1  138    0    2    0    0    5    0</span></span>
<span><span class="co">## [6,]    1 3234    0    0    0    0    5    6</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    0    0    6</span></span>
<span><span class="co">## [1] "ReaderSumm"</span></span>
<span><span class="co">##      [,1] [,2] [,3]</span></span>
<span><span class="co">## [1,]    1    2    6</span></span>
<span><span class="co">## List of 16</span></span>
<span><span class="co">##  $ MinAge     : num 1</span></span>
<span><span class="co">##  $ MaxAge     : num 100</span></span>
<span><span class="co">##  $ NDataSet   : num 1</span></span>
<span><span class="co">##  $ MaxReader  : num 6</span></span>
<span><span class="co">##  $ TheData    : num [1, 1:2494, 1:7] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ Npnt       : num 2494</span></span>
<span><span class="co">##  $ ReadPnt    : num [1, 1:6] 1 2 3 4 5 6</span></span>
<span><span class="co">##  $ NReaders   : num 6</span></span>
<span><span class="co">##  $ MinusA     : num 1</span></span>
<span><span class="co">##  $ PlusA      : num 50</span></span>
<span><span class="co">##  $ RefAge     : num 4</span></span>
<span><span class="co">##  $ ReaderSumm : num [1, 1:3] 1 2 6</span></span>
<span><span class="co">##  $ ReaderStruc: num [1:6, 1:8] 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ MaxCells   : num 10201</span></span>
<span><span class="co">##  $ TotalN     : num 20677</span></span>
<span><span class="co">##  $ EffN       : num 20677</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>We check the summary above against the information in the data file.
This data set has several inter-reader comparisons.</p>
<p>We load the model specifications using the <code>CreateSpecs</code>
function.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sable_spc</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/CreateSpecs.html">CreateSpecs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"Sable.spc"</span><span class="op">)</span>,</span>
<span>                                         DataSpecs<span class="op">=</span><span class="va">Sable_dat</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 7</span></span>
<span><span class="co">##  $ ModelSpecs:List of 6</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 1</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : num 1</span></span>
<span><span class="co">##   .. ..$ BiasLow  : num 0.001</span></span>
<span><span class="co">##   .. ..$ BiasHi   : num 3</span></span>
<span><span class="co">##   .. ..$ BiasUsed : num 1</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num 1</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num 0.001</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num 100</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num -1</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 2</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 2</span></span>
<span><span class="co">##   .. ..$ BiasPar  : num [1:3] 1e+00 1e-02 1e+02</span></span>
<span><span class="co">##   .. ..$ BiasLow  : num [1:3] 1e-03 -1e+01 1e-03</span></span>
<span><span class="co">##   .. ..$ BiasHi   : num [1:3] 10 1 200</span></span>
<span><span class="co">##   .. ..$ BiasUsed : num [1:3] 1 1 1</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num [1:3] 1 0.01 10</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num [1:3] 1e-03 -1e+01 1e-03</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num [1:3] 100 1 100</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num [1:3] 1 1 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num -3</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -3</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 0</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num 1</span></span>
<span><span class="co">##   .. ..$ BiasPar  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasLow  : NULL</span></span>
<span><span class="co">##   .. ..$ BiasHi   : NULL</span></span>
<span><span class="co">##   .. ..$ BiasUsed : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaPar : num 1</span></span>
<span><span class="co">##   .. ..$ SigmaLow : num 0.001</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : num 100</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: num 1</span></span>
<span><span class="co">##   ..$ :List of 10</span></span>
<span><span class="co">##   .. ..$ BiasOpt  : num 1</span></span>
<span><span class="co">##   .. ..$ SigOpt   : num -5</span></span>
<span><span class="co">##   .. ..$ BiasPar  : num 1</span></span>
<span><span class="co">##   .. ..$ BiasLow  : num 0.001</span></span>
<span><span class="co">##   .. ..$ BiasHi   : num 3</span></span>
<span><span class="co">##   .. ..$ BiasUsed : num 1</span></span>
<span><span class="co">##   .. ..$ SigmaPar : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaLow : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaHi  : NULL</span></span>
<span><span class="co">##   .. ..$ SigmaUsed: NULL</span></span>
<span><span class="co">##  $ NumSigma  : num 5</span></span>
<span><span class="co">##  $ NumBias   : num 5</span></span>
<span><span class="co">##  $ xvalsL    : num [1:6, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknotsL   : num [1:6] 0 0 0 0 0 0</span></span>
<span><span class="co">##  $ xvals     : num [1:6, 1:100] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ nknots    : num [1:6] 0 0 0 0 0 0</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>The Sablefish example fits three separate series (1-2, 3-4 &amp;
5-6). The model assumes the following:</p>
<p>Bias Options: Reader 5 is unbiased, readers 1 &amp; 2 have the same
constant bias, reader 6 has a separate constant bias while the bias of
readers 3 &amp; 4 is the same and follows a Michaelis-Menten
relationship. In the specifications file the first list relates to the
constant bias of readers 1 &amp; 2, the next three lines readers 3 &amp;
4, while the final line specifies the constant bias of reader 6. Reader
5 is assumed to be unbiased and therefore doesn’t require parameters to
be specified.</p>
<p>Sigma Options: Readers 1 &amp; 2 assume the same linear relationship
(constant CV), while readers 5 &amp; 6 have a separate linear
relationship. Readers 3 &amp; 4 assume ageing uncertainty follows a
Michaelis-Menten relationship. The parameters are specified in the same
manner as for the bias option (above).</p>
<p>The code below can be used to fit the Sablefish ageing error model.
We don’t run it because this particular model is very slow.</p>
<!-- We don't run this code -->
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## run the Sablefish model</span></span>
<span><span class="va">Sable_mod</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">::</span><span class="fu"><a href="../reference/DoApplyAgeError.html">DoApplyAgeError</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"Sable"</span>,</span>
<span>                                          DataSpecs <span class="op">=</span> <span class="va">Sable_dat</span>,</span>
<span>                                          ModelSpecsInp <span class="op">=</span> <span class="va">Sable_spc</span>,</span>
<span>                                          AprobWght <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>                                          SlopeWght <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>                                          SaveDir <span class="op">=</span> <span class="st">"Results"</span>,</span>
<span>                                          verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## save the model results</span></span>
<span><span class="va">Sable_out</span> <span class="op">&lt;-</span> <span class="fu">AgeingError</span><span class="fu">:::</span><span class="fu"><a href="../reference/ProcessResults.html">ProcessResults</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="st">"Sable"</span>, SaveDir <span class="op">=</span> <span class="st">"Results"</span>, CalcEff <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="trouble-shooting">Trouble Shooting<a class="anchor" aria-label="anchor" href="#trouble-shooting"></a>
</h2>
<p>Some suggestions for getting to a converged model are provided
below.</p>
<ul>
<li><p>Vary the initial values of the parameters in the specifications
file.</p></li>
<li><p>For models that are close to convergence, re-run the model using
the estimated parameters as the initial values.</p></li>
<li><p>Problematic data can be identified from the residual plots and at
the bottom of the report file with prediction probabilities &lt;1e-5.
Removing data with low probability can improve the fit.</p></li>
<li><p>There may not be sufficient data to estimate ageing error for
multiple combinations of readers, the data can be pooled to estimate
fewer parameters (bias / sigma option <code>-x</code>)</p></li>
<li><p>The model may not be appropriate, select a different model based
on the residual plots.</p></li>
<li><p>Prespecify (fix) one or more parameters for a pair of
readers.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>Fish Ageing Services <a href="https://www.fishageingservices.com/" class="external-link uri">https://www.fishageingservices.com/</a> provided the data
for Blue Grenadier, Bight Redfish, and School Whiting and the Australian
Fisheries Management Authority (AFMA) provided funding for the data
collection and otolith reading.</p>
<p>The sablefish age data are provided by the NWFSC.</p>
<p>This document is prepared from documentation and examples written by
André Punt. Pia Bessell-Browne provided helpful comments that improved
this document.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Day, J., Hall, K., Bessell-Browne, P., and Sporcic, M. (2020) School
Whiting (<em>Sillago flindersi</em>) stock assessment based on data up
to 2019. For discussion at SERAG, December 2020.</p>
<p>Curin-Osorio, S., and Burch, P. (2022). Bight Redfish
(<em>Centroberyx gerrardi</em>) stock assessment based on data up to
2021-22. Technical paper presented to the GABRAG, 22 November 2022,
Hobart, Tasmania.</p>
<p>Punt, A.E., Smith, D.C., KrusicGolub, K., and Robertson, S. (2008).
Quantifying age-reading error for use in fisheries stock assessments,
with application to species in Australia’s southern and eastern
scalefish and shark fishery. <em>Canadian Journal of Fisheries and
Aquatic Sciences</em> 65: 1991–2005. <a href="https://doi.org/10.1139/F08-111" class="external-link uri">https://doi.org/10.1139/F08-111</a></p>
<p>Tuck, G.N., Bessell-Browne, P. (2022). Blue Grenadier (<em>Macruronus
novaezelandiae</em>) stock assessment based on data up to 2021.
Technical paper presented to theSERAG2, 29–-30<span class="math inline">\(^{th}\)</span> November 2022, Melbourne, Victoria.
99pp.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andre E. Punt, Kelli F. Johnson, Ian G. Taylor, Paul Burch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
